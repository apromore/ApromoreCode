<?xml version="1.0" encoding="utf-8"?>
<!-- 
	Just a very simple ANT script doing everything of a complete Apromore build in a row.
	This ANT script relies on a special directory structure and is only a temporary solution. 
		
	Added by Felix Mannhardt 
-->
<project name="Apromore - Copy and Build all WAR" default="deploy-war">

    <import file="build-virgo.xml"/>

    <!--
        Local properties for your developer machine. This will override whatever is defined in build.properties!
        You should never check this into SVN.
    -->
    <property file="apromore-deploy/local.properties"/>

    <!-- Standard properties for the build enviroment -->
    <property file="apromore-deploy/build.properties"/>

    <!-- Delete all deployed WAR files -->
    <target name="clean-war">
        <delete file="${dir-tomcat-webapps}/manager.war"/>
        <delete file="${dir-tomcat-webapps}/portal.war"/>
        <delete file="${dir-tomcat-webapps}/editor.war"/>
        <delete dir="${dir-tomcat-webapps}/manager"/>
        <delete dir="${dir-tomcat-webapps}/portal"/>
        <delete dir="${dir-tomcat-webapps}/editor"/>
    </target>

    <!-- Build all WAR files using ANT and Maven -->
    <target name="build-war" depends="clean-war">
        <!-- Prepare Signavio Editor -->
        <ant antfile="build.xml" target="build-all-in-one-war" dir="Apromore-Editor/" inheritall="false"/>

        <!--  Run Apromore Maven -->
        <exec dir="." executable="cmd" osfamily="windows">
            <arg value="/c"/>
            <arg value="mvn"/>
            <arg line="clean install cobertura:cobertura"/>
        </exec>
        <exec executable="mvn" osfamily="unix">
            <arg value="clean"/>
            <arg value="install"/>
            <arg value="cobertura:cobertura"/>
        </exec>
    </target>

    <!-- Copy all WAR files to Tomcat -->
    <target name="copy-war" depends="build-war">
        <copy file="Apromore-Editor/target/editor.war" todir="${dir-tomcat-webapps}"/>
        <copy file="Apromore-Core/apromore-webapp/target/manager.war" todir="${dir-tomcat-webapps}"/>
        <copy file="Apromore-Portal/portal-webapp/target/portal.war" todir="${dir-tomcat-webapps}"/>
    </target>

    <target name="deploy-war" depends="copy-war"/>

    <target name="copy-war-nodep">
        <copy file="Apromore-Editor/target/editor.war" todir="${dir-tomcat-webapps}"/>
        <copy file="Apromore-Core/apromore-webapp/target/manager.war" todir="${dir-tomcat-webapps}"/>
        <copy file="Apromore-Portal/portal-webapp/target/portal.war" todir="${dir-tomcat-webapps}"/>
    </target>

</project>